<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Tiny To-Do (Azure + Flask)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --uva-navy:#232D4B;
      --uva-orange:#E57200;
      --gray-50:#f9fafb;
      --gray-200:#e5e7eb;
      --gray-600:#4b5563;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      background:var(--gray-50);
      color:#0f172a;
    }
    header{
      background:var(--uva-navy);
      color:#fff;
      padding:1rem 1.2rem;
    }
    header h1{margin:0;font-size:1.3rem}
    main{
      max-width:720px;
      margin:1rem auto;
      padding:0 1rem 2rem;
    }
    .card{
      background:#fff;
      border:1px solid var(--gray-200);
      border-radius:12px;
      padding:1rem;
      box-shadow:0 2px 10px rgba(15,23,42,.05);
      margin-bottom:1rem;
    }
    .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
    input[type=text]{
      flex:1;
      min-width:140px;
      padding:.55rem .7rem;
      border-radius:10px;
      border:1px solid var(--gray-200);
      font-size:.95rem;
    }
    button{
      border-radius:10px;
      border:1px solid var(--uva-navy);
      background:var(--uva-navy);
      color:#fff;
      font-weight:600;
      padding:.5rem .9rem;
      cursor:pointer;
    }
    button.secondary{
      border-color:var(--gray-200);
      background:#fff;
      color:var(--uva-navy);
    }
    ul{
      list-style:none;
      padding:0;
      margin:.5rem 0 0;
    }
    li{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:.5rem;
      padding:.4rem .2rem;
      border-bottom:1px solid var(--gray-200);
    }
    .text{
      flex:1;
      display:flex;
      align-items:center;
      gap:.5rem;
      word-break:break-word;
    }
    .done{ text-decoration:line-through; color:var(--gray-600); }
    .muted{color:var(--gray-600);font-size:.85rem}
    .pill{font-size:.75rem;background:#e0f2fe;border-radius:999px;padding:.1rem .5rem;color:#0369a1}
  </style>
</head>
<body>
  <header>
    <h1>Tiny To-Do • Azure + Flask + Blob</h1>
  </header>
  <main>
    <section class="card">
      <div class="row">
        <input type="text" id="newText" placeholder="Add a new task…" />
        <button onclick="addTodo()">Add</button>
      </div>
      <p class="muted" id="status"></p>
    </section>

    <section class="card">
      <div class="row" style="justify-content:space-between;">
        <div><strong>Tasks</strong> <span id="count" class="pill">0</span></div>
        <button class="secondary" onclick="loadTodos()">Refresh</button>
      </div>
      <ul id="list"></ul>
    </section>
  </main>

  <script>
    async function loadTodos(){
      setStatus("Loading…");
      try{
        const r = await fetch("/api/todos");
        const j = await r.json();
        if(!j.ok){ throw new Error(j.error || "Failed to load"); }
        renderTodos(j.todos || []);
        clearStatus();
      }catch(e){
        console.error(e);
        setStatus("Error loading todos: " + e.message);
      }
    }

    function renderTodos(todos){
      const ul = document.getElementById("list");
      const count = document.getElementById("count");
      ul.innerHTML = "";
      count.textContent = todos.length;
      if(todos.length === 0){
        ul.innerHTML = '<li class="muted">No tasks yet. Add one above.</li>';
        return;
      }
      for(const t of todos){
        const li = document.createElement("li");

        const left = document.createElement("div");
        left.className = "text";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!t.done;
        cb.onchange = () => toggleTodo(t.id);

        const span = document.createElement("span");
        span.textContent = t.text;
        if(t.done) span.classList.add("done");

        left.appendChild(cb);
        left.appendChild(span);

        const del = document.createElement("button");
        del.textContent = "Delete";
        del.className = "secondary";
        del.onclick = () => deleteTodo(t.id);

        li.appendChild(left);
        li.appendChild(del);
        ul.appendChild(li);
      }
    }

    function setStatus(msg){
      document.getElementById("status").textContent = msg;
    }
    function clearStatus(){
      setStatus("");
    }

    async function addTodo(){
      const inp = document.getElementById("newText");
      const text = inp.value.trim();
      if(!text){ return; }
      setStatus("Adding…");
      try{
        const r = await fetch("/api/todos", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body:JSON.stringify({text})
        });
        const j = await r.json();
        if(!j.ok){ throw new Error(j.error || "Failed to add"); }
        inp.value = "";
        await loadTodos();
      }catch(e){
        console.error(e);
        setStatus("Error adding: " + e.message);
      }
    }

    async function toggleTodo(id){
      try{
        await fetch(`/api/todos/${id}/toggle`, {method:"POST"});
        await loadTodos();
      }catch(e){
        console.error(e);
        setStatus("Error toggling: " + e.message);
      }
    }

    async function deleteTodo(id){
      if(!confirm("Delete this task?")) return;
      try{
        await fetch(`/api/todos/${id}`, {method:"DELETE"});
        await loadTodos();
      }catch(e){
        console.error(e);
        setStatus("Error deleting: " + e.message);
      }
    }

    document.addEventListener("DOMContentLoaded", loadTodos);
  </script>
</body>
</html>
